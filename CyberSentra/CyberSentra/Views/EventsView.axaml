<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignWidth="900"
             d:DesignHeight="520"
             x:Class="CyberSentra.EventsView"
             x:CompileBindings="False">

    <UserControl.Styles>
        <Style Selector="Border.page-card">
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Background" Value="#0F1726"/>
        </Style>

        <Style Selector="ToggleButton.pill">
            <Setter Property="Padding" Value="14,7"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style Selector="ToggleButton.pill:pointerover">
            <Setter Property="Background" Value="#16223A"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
        </Style>
        <Style Selector="ToggleButton.pill:checked">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource SidebarBackground}"/>
        </Style>

        <Style Selector="Button.pill">
            <Setter Property="Padding" Value="14,7"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style Selector="Button.pill:pointerover">
            <Setter Property="Background" Value="#16223A"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
        </Style>

        <Style Selector="Button.pill.soft">
            <Setter Property="Background" Value="{StaticResource AccentSoftBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentSoftBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource SidebarBackground}"/>
        </Style>

        <Style Selector="DataGrid.modern-grid">
            <Setter Property="RowHeight" Value="NaN"/>
            <Setter Property="ColumnHeaderHeight" Value="42"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>

        <Style Selector="DataGrid.modern-grid DataGridColumnHeader">
            <Setter Property="Background" Value="#0B1324"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="10,10"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style Selector="DataGrid.modern-grid DataGridRow:pointerover">
            <Setter Property="Background" Value="#0B1324"/>
        </Style>

        <Style Selector="DataGrid.modern-grid DataGridCell">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,*" RowSpacing="12">

        <!-- Header / toolbar -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" VerticalAlignment="Center">
            <StackPanel Spacing="2">
                <TextBlock Text="Events"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           FontSize="18"
                           FontWeight="Bold"/>
                <TextBlock Text="Browse and filter collected events"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           FontSize="12"/>
            </StackPanel>

            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        VerticalAlignment="Center">

                <ToggleButton x:Name="SysmonBtn"
                              Classes="pill"
                              Content="Sysmon"
                              Click="SourceButton_Click"/>

                <ToggleButton x:Name="EventViewerBtn"
                              Classes="pill"
                              Content="Event Viewer"
                              IsChecked="True"
                              Click="SourceButton_Click"/>

                <Button x:Name="FilterButton"
                        Classes="pill soft"
                        Content="🔎 Filter"
                        Click="FilterButton_Click"/>
            </StackPanel>
        </Grid>

        <!-- Main card -->
        <Border Grid.Row="1"
                Classes="page-card"
                BorderBrush="{StaticResource BorderDarkBrush}"
                BorderThickness="1">

            <DataGrid Classes="modern-grid"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      AutoGenerateColumns="False"
                      CanUserReorderColumns="False"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="False"
                      Foreground="{StaticResource TextPrimaryBrush}"
                      ItemsSource="{Binding Events}">

                <DataGrid.Columns>

                    <DataGridTemplateColumn Header="Time" Width="170">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Time}" MaxLines="2" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Type" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Type}" MaxLines="2" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Severity" Width="110">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Severity}" MaxLines="2" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="User" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding User}" MaxLines="2" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Process" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Process}" MaxLines="2" TextWrapping="Wrap"
                                           TextTrimming="CharacterEllipsis"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Details with View -->
                    <DataGridTemplateColumn Header="Details" Width="3*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                    <TextBlock Grid.Column="0"
                                               Text="{Binding Details}"
                                               MaxLines="2"
                                               TextWrapping="Wrap"
                                               TextTrimming="CharacterEllipsis"/>

                                    <Button Grid.Column="1"
                                            Classes="pill"
                                            Padding="10,4"
                                            Content="View"
                                            Click="ViewDetails_Click"/>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Source" Width="160">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Source}" MaxLines="2" TextWrapping="Wrap"
                                           TextTrimming="CharacterEllipsis"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
