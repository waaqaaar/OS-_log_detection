<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="CyberSentra.HistoricalThreatsView"
             x:CompileBindings="False"
             d:DesignWidth="900"
             d:DesignHeight="700">

  <UserControl.Styles>

    <Style Selector="Border.page-card">
      <Setter Property="CornerRadius" Value="16"/>
      <Setter Property="Padding" Value="14"/>
      <Setter Property="Background" Value="#0F1726"/>
    </Style>

    <Style Selector="Button.pill">
      <Setter Property="Padding" Value="12,6"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Height" Value="32"/>
    </Style>
    <Style Selector="Button.pill:pointerover">
      <Setter Property="Background" Value="#16223A"/>
      <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
    </Style>

    <Style Selector="ComboBox.field">
      <Setter Property="Height" Value="32"/>
      <Setter Property="Padding" Value="8,4"/>
    </Style>

    <Style Selector="DataGrid.modern-grid">
      <Setter Property="RowHeight" Value="NaN"/>
      <Setter Property="ColumnHeaderHeight" Value="42"/>
      <Setter Property="GridLinesVisibility" Value="None"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
      <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
    </Style>

    <Style Selector="DataGrid.modern-grid DataGridColumnHeader">
      <Setter Property="Background" Value="#0B1324"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
      <Setter Property="BorderThickness" Value="0,0,0,1"/>
      <Setter Property="Padding" Value="10,10"/>
      <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
    </Style>

    <Style Selector="DataGrid.modern-grid DataGridRow:pointerover">
      <Setter Property="Background" Value="#0B1324"/>
    </Style>

    <Style Selector="DataGrid.modern-grid DataGridCell">
      <Setter Property="Padding" Value="10,8"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>

  </UserControl.Styles>

  <Grid RowDefinitions="Auto,Auto,*" RowSpacing="12">

    <!-- Header -->
    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalAlignment="Center">
      <StackPanel Spacing="2">
        <TextBlock Text="Threat History"
                   Foreground="{StaticResource TextPrimaryBrush}"
                   FontSize="18"
                   FontWeight="Bold"/>
        <TextBlock Text="Historical detections from database"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="12"/>
      </StackPanel>
    </Grid>

    <!-- Filter bar -->
    <Border Grid.Row="1"
            Classes="page-card"
            BorderBrush="{StaticResource BorderDarkBrush}"
            BorderThickness="1">

      <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,*" ColumnSpacing="12" VerticalAlignment="Center">
        <TextBlock Text="Time:"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="12"
                   VerticalAlignment="Center"/>

        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
          <ToggleButton x:Name="AllTimeButton"
                        Classes="pill"
                        Content="All"
                        IsChecked="True"
                        Click="TimeFilterButton_Click"/>
          <ToggleButton x:Name="Last24hButton"
                        Classes="pill"
                        Content="Last 24h"
                        Click="TimeFilterButton_Click"/>
          <ToggleButton x:Name="Last7dButton"
                        Classes="pill"
                        Content="Last 7d"
                        Click="TimeFilterButton_Click"/>
        </StackPanel>

        <TextBlock Grid.Column="2"
                   Text="Severity:"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="12"
                   VerticalAlignment="Center"
                   Margin="12,0,0,0"/>

        <ComboBox x:Name="SeverityCombo"
                  Grid.Column="3"
                  Classes="field"
                  Width="140"
                  SelectionChanged="SeverityFilter_SelectionChanged">
          <ComboBoxItem Content="All" IsSelected="True"/>
          <ComboBoxItem Content="Low"/>
          <ComboBoxItem Content="Medium"/>
          <ComboBoxItem Content="High"/>
        </ComboBox>

        <TextBlock Grid.Column="4"
                   Text="{Binding FilterSummary}"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="12"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Right"/>
      </Grid>
    </Border>

    <!-- Grid -->
    <Border Grid.Row="2"
            Classes="page-card"
            BorderBrush="{StaticResource BorderDarkBrush}"
            BorderThickness="1">

      <DataGrid x:Name="ThreatsGrid"
                Classes="modern-grid"
                ItemsSource="{Binding Threats}"
                AutoGenerateColumns="False"
                CanUserReorderColumns="False"
                CanUserResizeColumns="True"
                CanUserSortColumns="False"
                Foreground="{StaticResource TextPrimaryBrush}"
                IsReadOnly="True">

        <DataGrid.Columns>

          <DataGridTemplateColumn Header="Time" Width="180">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Time}" MaxLines="2" TextWrapping="Wrap"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Technique" Width="140">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Technique}" MaxLines="1" TextTrimming="CharacterEllipsis"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Name" Width="200">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Name}" MaxLines="1" TextTrimming="CharacterEllipsis"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Tactic" Width="160">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Tactic}" MaxLines="1" TextTrimming="CharacterEllipsis"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Severity" Width="120">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Severity}"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Details preview + View -->
          <DataGridTemplateColumn Header="Details" Width="3*">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                  <TextBlock Grid.Column="0"
                             Text="{Binding Details}"
                             MaxLines="2"
                             TextWrapping="Wrap"
                             TextTrimming="CharacterEllipsis"/>
                  <Button Grid.Column="1"
                          Classes="pill"
                          Height="28"
                          Padding="10,4"
                          Content="View"
                          Click="ViewThreatDetails_Click"/>
                </Grid>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

        </DataGrid.Columns>

      </DataGrid>
    </Border>

  </Grid>
</UserControl>
