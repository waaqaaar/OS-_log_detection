<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="CyberSentra.ThreatsView"
             x:CompileBindings="False"
             d:DesignWidth="900"
             d:DesignHeight="520">

  <UserControl.Styles>

    <Style Selector="Border.page-card">
      <Setter Property="CornerRadius" Value="16"/>
      <Setter Property="Padding" Value="14"/>
      <Setter Property="Background" Value="#0F1726"/>
    </Style>

    <Style Selector="TextBox.field">
      <Setter Property="Width" Value="160"/>
      <Setter Property="Padding" Value="10,6"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
      <Setter Property="Background" Value="#0B1324"/>
      <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
    </Style>

    <Style Selector="ComboBox.field">
      <Setter Property="Width" Value="140"/>
      <Setter Property="Padding" Value="10,6"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
      <Setter Property="Background" Value="#0B1324"/>
      <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
    </Style>

    <Style Selector="Button.pill">
      <Setter Property="Padding" Value="12,6"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
      <Setter Property="FontSize" Value="12"/>
    </Style>
    <Style Selector="Button.pill:pointerover">
      <Setter Property="Background" Value="#16223A"/>
      <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
    </Style>

    <Style Selector="DataGrid.modern-grid">
      <Setter Property="RowHeight" Value="NaN"/>
      <Setter Property="ColumnHeaderHeight" Value="42"/>
      <Setter Property="GridLinesVisibility" Value="None"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
      <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
    </Style>

    <Style Selector="DataGrid.modern-grid DataGridColumnHeader">
      <Setter Property="Background" Value="#0B1324"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}"/>
      <Setter Property="BorderThickness" Value="0,0,0,1"/>
      <Setter Property="Padding" Value="10,10"/>
      <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
    </Style>

    <Style Selector="DataGrid.modern-grid DataGridRow:pointerover">
      <Setter Property="Background" Value="#0B1324"/>
    </Style>

    <Style Selector="DataGrid.modern-grid DataGridCell">
      <Setter Property="Padding" Value="10,8"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>

  </UserControl.Styles>

  <Grid RowDefinitions="Auto,*" RowSpacing="12">

    <!-- Header + filters -->
    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalAlignment="Center">
      <StackPanel Spacing="2">
        <TextBlock Text="Detected Threats"
                   Foreground="{StaticResource TextPrimaryBrush}"
                   FontSize="18"
                   FontWeight="Bold"/>
        <StackPanel Orientation="Horizontal" Spacing="14">
          <TextBlock Text="{Binding TotalThreatsText}"
                     Foreground="{StaticResource TextSecondaryBrush}"
                     FontSize="12"/>
          <TextBlock Text="{Binding HighSeverityText}"
                     Foreground="{StaticResource TextSecondaryBrush}"
                     FontSize="12"/>
        </StackPanel>
      </StackPanel>

      <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">

        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
          <TextBlock Text="Technique"
                     Foreground="{StaticResource TextSecondaryBrush}"
                     FontSize="12"
                     VerticalAlignment="Center"/>
          <TextBox x:Name="TechniqueSearchBox"
                   Classes="field"
                   Watermark="e.g. T1059"
                   KeyUp="TechniqueSearchBox_KeyUp"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
          <TextBlock Text="Severity"
                     Foreground="{StaticResource TextSecondaryBrush}"
                     FontSize="12"
                     VerticalAlignment="Center"/>
          <ComboBox x:Name="SeverityCombo"
                    Classes="field"
                    SelectionChanged="SeverityCombo_SelectionChanged">
            <ComboBoxItem Content="All" IsSelected="True"/>
            <ComboBoxItem Content="Low"/>
            <ComboBoxItem Content="Medium"/>
            <ComboBoxItem Content="High"/>
          </ComboBox>
        </StackPanel>

      </StackPanel>
    </Grid>

    <!-- Card + grid -->
    <Border Grid.Row="1"
            Classes="page-card"
            BorderBrush="{StaticResource BorderDarkBrush}"
            BorderThickness="1">

      <DataGrid Classes="modern-grid"
                IsReadOnly="True"
                ItemsSource="{Binding Threats}"
                HeadersVisibility="Column"
                AutoGenerateColumns="False"
                CanUserReorderColumns="False"
                CanUserResizeColumns="True"
                CanUserSortColumns="False"
                Foreground="{StaticResource TextPrimaryBrush}">

        <DataGrid.Columns>

          <DataGridTemplateColumn Header="Time" Width="170">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Time}" MaxLines="2" TextWrapping="Wrap"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Technique" Width="120">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Technique}" FontWeight="SemiBold"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Name" Width="220">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Name}" MaxLines="2" TextWrapping="Wrap" TextTrimming="CharacterEllipsis"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Tactic" Width="160">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Tactic}" MaxLines="2" TextWrapping="Wrap" TextTrimming="CharacterEllipsis"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Severity" Width="100">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Severity}" Foreground="{StaticResource AccentBrush}" FontWeight="SemiBold"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Details: preview + View full -->
          <DataGridTemplateColumn Header="Details" Width="3*">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                  <TextBlock Grid.Column="0"
                             Text="{Binding Details}"
                             MaxLines="2"
                             TextWrapping="Wrap"
                             TextTrimming="CharacterEllipsis"/>
                  <Button Grid.Column="1"
                          Classes="pill"
                          Padding="10,4"
                          Content="View"
                          Click="ViewThreatDetails_Click"/>
                </Grid>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

        </DataGrid.Columns>

      </DataGrid>

    </Border>

  </Grid>
</UserControl>
